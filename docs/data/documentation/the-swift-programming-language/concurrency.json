{"kind":"article","identifier":{"interfaceLanguage":"swift","url":"doc:\/\/org.swift.tspl\/documentation\/The-Swift-Programming-Language\/Concurrency"},"sections":[],"schemaVersion":{"major":0,"minor":3,"patch":0},"primaryContentSections":[{"content":[{"inlineContent":[{"text":"Swift has built-in support for writing asynchronous and parallel code","type":"text"},{"type":"text","text":" "},{"text":"in a structured way.","type":"text"},{"type":"text","text":" "},{"type":"emphasis","inlineContent":[{"text":"Asynchronous code","type":"text"}]},{"type":"text","text":" can be suspended and resumed later,"},{"text":" ","type":"text"},{"type":"text","text":"although only one piece of the program executes at a time."},{"type":"text","text":" "},{"text":"Suspending and resuming code in your program","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"lets it continue to make progress"},{"text":" ","type":"text"},{"type":"text","text":"on short-term operations like updating its UI"},{"type":"text","text":" "},{"type":"text","text":"while continuing to work on long-running operations"},{"type":"text","text":" "},{"text":"like fetching data over the network or parsing files.","type":"text"},{"text":" ","type":"text"},{"type":"emphasis","inlineContent":[{"type":"text","text":"Parallel code"}]},{"type":"text","text":" means multiple pieces of code run simultaneously —"},{"text":" ","type":"text"},{"text":"for example, a computer with a four-core processor","type":"text"},{"type":"text","text":" "},{"type":"text","text":"can run four pieces of code at the same time,"},{"text":" ","type":"text"},{"text":"with each core carrying out one of the tasks.","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"A program that uses parallel and asynchronous code"},{"type":"text","text":" "},{"text":"carries out multiple operations at a time;","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"it suspends operations that are waiting for an external system,"},{"type":"text","text":" "},{"type":"text","text":"and makes it easier to write this code in a memory-safe way."}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"text":"The additional scheduling flexibility from parallel or asynchronous code","type":"text"},{"type":"text","text":" "},{"type":"text","text":"also comes with a cost of increased complexity."},{"type":"text","text":" "},{"text":"Swift lets you express your intent","type":"text"},{"type":"text","text":" "},{"type":"text","text":"in a way that enables some compile-time checking —"},{"text":" ","type":"text"},{"type":"text","text":"for example, you can use actors to safely access mutable state."},{"text":" ","type":"text"},{"text":"However, adding concurrency to slow or buggy code","type":"text"},{"type":"text","text":" "},{"text":"isn’t a guarantee that it will become fast or correct.","type":"text"},{"type":"text","text":" "},{"text":"In fact, adding concurrency might even make your code harder to debug.","type":"text"},{"type":"text","text":" "},{"type":"text","text":"However, using Swift’s language-level support for concurrency"},{"text":" ","type":"text"},{"type":"text","text":"in code that needs to be concurrent"},{"type":"text","text":" "},{"type":"text","text":"means Swift can help you catch problems at compile time."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"The rest of this chapter uses the term "},{"inlineContent":[{"text":"concurrency","type":"text"}],"type":"emphasis"},{"text":" ","type":"text"},{"text":"to refer to this common combination of asynchronous and parallel code.","type":"text"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"If you’ve written concurrent code before,","type":"text"},{"type":"text","text":" "},{"type":"text","text":"you might be used to working with threads."},{"type":"text","text":" "},{"type":"text","text":"The concurrency model in Swift is built on top of threads,"},{"type":"text","text":" "},{"text":"but you don’t interact with them directly.","type":"text"},{"type":"text","text":" "},{"type":"text","text":"An asynchronous function in Swift"},{"text":" ","type":"text"},{"type":"text","text":"can give up the thread that it’s running on,"},{"text":" ","type":"text"},{"type":"text","text":"which lets another asynchronous function run on that thread"},{"text":" ","type":"text"},{"text":"while the first function is blocked.","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"When an asynchronous function resumes,"},{"text":" ","type":"text"},{"type":"text","text":"Swift doesn’t make any guarantee about which thread"},{"type":"text","text":" "},{"text":"that function will run on.","type":"text"}]}],"type":"aside","name":"Note","style":"note"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Although it’s possible to write concurrent code"},{"text":" ","type":"text"},{"text":"without using Swift’s language support,","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"that code tends to be harder to read."},{"type":"text","text":" "},{"type":"text","text":"For example, the following code downloads a list of photo names,"},{"text":" ","type":"text"},{"type":"text","text":"downloads the first photo in that list,"},{"type":"text","text":" "},{"text":"and shows that photo to the user:","type":"text"}]},{"type":"codeListing","syntax":"swift","code":["listPhotos(inGallery: \"Summer Vacation\") { photoNames in","    let sortedNames = photoNames.sorted()","    let name = sortedNames[0]","    downloadPhoto(named: name) { photo in","        show(photo)","    }","}"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Even in this simple case,"},{"type":"text","text":" "},{"type":"text","text":"because the code has to be written as a series of completion handlers,"},{"text":" ","type":"text"},{"type":"text","text":"you end up writing nested closures."},{"text":" ","type":"text"},{"type":"text","text":"In this style,"},{"type":"text","text":" "},{"type":"text","text":"more complex code with deep nesting can quickly become unwieldy."}]},{"anchor":"Definici%C3%B3n-y-llamado-de-funciones-as%C3%ADncronas","level":2,"type":"heading","text":"Definición y llamado de funciones asíncronas"},{"type":"paragraph","inlineContent":[{"type":"text","text":"An "},{"inlineContent":[{"type":"text","text":"asynchronous function"}],"type":"emphasis"},{"type":"text","text":" or "},{"type":"emphasis","inlineContent":[{"type":"text","text":"asynchronous method"}]},{"text":" ","type":"text"},{"type":"text","text":"is a special kind of function or method"},{"type":"text","text":" "},{"type":"text","text":"that can be suspended while it’s partway through execution."},{"type":"text","text":" "},{"type":"text","text":"This is in contrast to ordinary, synchronous functions and methods,"},{"text":" ","type":"text"},{"type":"text","text":"which either run to completion, throw an error, or never return."},{"text":" ","type":"text"},{"type":"text","text":"An asynchronous function or method still does one of those three things,"},{"text":" ","type":"text"},{"type":"text","text":"but it can also pause in the middle when it’s waiting for something."},{"type":"text","text":" "},{"type":"text","text":"Inside the body of an asynchronous function or method,"},{"text":" ","type":"text"},{"type":"text","text":"you mark each of these places where execution can be suspended."}]},{"inlineContent":[{"type":"text","text":"To indicate that a function or method is asynchronous,"},{"text":" ","type":"text"},{"text":"you write the ","type":"text"},{"type":"codeVoice","code":"async"},{"text":" keyword in its declaration after its parameters,","type":"text"},{"type":"text","text":" "},{"type":"text","text":"similar to how you use "},{"code":"throws","type":"codeVoice"},{"type":"text","text":" to mark a throwing function."},{"type":"text","text":" "},{"type":"text","text":"If the function or method returns a value,"},{"text":" ","type":"text"},{"type":"text","text":"you write "},{"code":"async","type":"codeVoice"},{"text":" before the return arrow (","type":"text"},{"code":"->","type":"codeVoice"},{"text":").","type":"text"},{"type":"text","text":" "},{"text":"For example,","type":"text"},{"text":" ","type":"text"},{"text":"here’s how you might fetch the names of photos in a gallery:","type":"text"}],"type":"paragraph"},{"type":"codeListing","syntax":"swift","code":["func listPhotos(inGallery name: String) async -> [String] {","    let result = \/\/ ... some asynchronous networking code ...","    return result","}"]},{"inlineContent":[{"type":"text","text":"For a function or method that’s both asynchronous and throwing,"},{"type":"text","text":" "},{"type":"text","text":"you write "},{"type":"codeVoice","code":"async"},{"text":" before ","type":"text"},{"code":"throws","type":"codeVoice"},{"text":".","type":"text"}],"type":"paragraph"},{"inlineContent":[{"text":"When calling an asynchronous method,","type":"text"},{"type":"text","text":" "},{"text":"execution suspends until that method returns.","type":"text"},{"type":"text","text":" "},{"type":"text","text":"You write "},{"type":"codeVoice","code":"await"},{"text":" in front of the call","type":"text"},{"type":"text","text":" "},{"text":"to mark the possible suspension point.","type":"text"},{"type":"text","text":" "},{"type":"text","text":"This is like writing "},{"type":"codeVoice","code":"try"},{"type":"text","text":" when calling a throwing function,"},{"text":" ","type":"text"},{"type":"text","text":"to mark the possible change to the program’s flow if there’s an error."},{"type":"text","text":" "},{"text":"Inside an asynchronous method,","type":"text"},{"type":"text","text":" "},{"text":"the flow of execution is suspended ","type":"text"},{"type":"emphasis","inlineContent":[{"type":"text","text":"only"}]},{"type":"text","text":" when you call another asynchronous method —"},{"type":"text","text":" "},{"type":"text","text":"suspension is never implicit or preemptive —"},{"text":" ","type":"text"},{"type":"text","text":"which means every possible suspension point is marked with "},{"type":"codeVoice","code":"await"},{"type":"text","text":"."}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"type":"text","text":"For example,"},{"type":"text","text":" "},{"text":"the code below fetches the names of all the pictures in a gallery","type":"text"},{"type":"text","text":" "},{"text":"and then shows the first picture:","type":"text"}]},{"type":"codeListing","code":["let photoNames = await listPhotos(inGallery: \"Summer Vacation\")","let sortedNames = photoNames.sorted()","let name = sortedNames[0]","let photo = await downloadPhoto(named: name)","show(photo)"],"syntax":"swift"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Because the "},{"type":"codeVoice","code":"listPhotos(inGallery:)"},{"type":"text","text":" and "},{"type":"codeVoice","code":"downloadPhoto(named:)"},{"type":"text","text":" functions"},{"type":"text","text":" "},{"type":"text","text":"both need to make network requests,"},{"type":"text","text":" "},{"text":"they could take a relatively long time to complete.","type":"text"},{"type":"text","text":" "},{"text":"Making them both asynchronous by writing ","type":"text"},{"type":"codeVoice","code":"async"},{"text":" before the return arrow","type":"text"},{"type":"text","text":" "},{"type":"text","text":"lets the rest of the app’s code keep running"},{"text":" ","type":"text"},{"text":"while this code waits for the picture to be ready.","type":"text"}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"To understand the concurrent nature of the example above,"},{"type":"text","text":" "},{"text":"here’s one possible order of execution:","type":"text"}]},{"type":"orderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"The code starts running from the first line"},{"type":"text","text":" "},{"type":"text","text":"and runs up to the first "},{"type":"codeVoice","code":"await"},{"text":".","type":"text"},{"type":"text","text":" "},{"type":"text","text":"It calls the "},{"code":"listPhotos(inGallery:)","type":"codeVoice"},{"text":" function","type":"text"},{"text":" ","type":"text"},{"text":"and suspends execution while it waits for that function to return.","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"While this code’s execution is suspended,","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"some other concurrent code in the same program runs."},{"text":" ","type":"text"},{"text":"For example, maybe a long-running background task","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"continues updating a list of new photo galleries."},{"type":"text","text":" "},{"text":"That code also runs until the next suspension point, marked by ","type":"text"},{"code":"await","type":"codeVoice"},{"type":"text","text":","},{"text":" ","type":"text"},{"text":"or until it completes.","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"After "},{"type":"codeVoice","code":"listPhotos(inGallery:)"},{"type":"text","text":" returns,"},{"type":"text","text":" "},{"text":"this code continues execution starting at that point.","type":"text"},{"type":"text","text":" "},{"text":"It assigns the value that was returned to ","type":"text"},{"type":"codeVoice","code":"photoNames"},{"text":".","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"The lines that define "},{"code":"sortedNames","type":"codeVoice"},{"type":"text","text":" and "},{"code":"name","type":"codeVoice"},{"text":" ","type":"text"},{"text":"are regular, synchronous code.","type":"text"},{"type":"text","text":" "},{"type":"text","text":"Because nothing is marked "},{"type":"codeVoice","code":"await"},{"type":"text","text":" on these lines,"},{"text":" ","type":"text"},{"text":"there aren’t any possible suspension points.","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"The next ","type":"text"},{"code":"await","type":"codeVoice"},{"type":"text","text":" marks the call to the "},{"type":"codeVoice","code":"downloadPhoto(named:)"},{"text":" function.","type":"text"},{"type":"text","text":" "},{"type":"text","text":"This code pauses execution again until that function returns,"},{"text":" ","type":"text"},{"type":"text","text":"giving other concurrent code an opportunity to run."}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"After ","type":"text"},{"type":"codeVoice","code":"downloadPhoto(named:)"},{"type":"text","text":" returns,"},{"type":"text","text":" "},{"text":"its return value is assigned to ","type":"text"},{"code":"photo","type":"codeVoice"},{"type":"text","text":" "},{"text":"and then passed as an argument when calling ","type":"text"},{"code":"show(_:)","type":"codeVoice"},{"text":".","type":"text"}]}]}]},{"inlineContent":[{"type":"text","text":"The possible suspension points in your code marked with "},{"code":"await","type":"codeVoice"},{"type":"text","text":" "},{"text":"indicate that the current piece of code might pause execution","type":"text"},{"text":" ","type":"text"},{"text":"while waiting for the asynchronous function or method to return.","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"This is also called "},{"inlineContent":[{"type":"text","text":"yielding the thread"}],"type":"emphasis"},{"text":" ","type":"text"},{"type":"text","text":"because, behind the scenes,"},{"type":"text","text":" "},{"type":"text","text":"Swift suspends the execution of your code on the current thread"},{"type":"text","text":" "},{"type":"text","text":"and runs some other code on that thread instead."},{"type":"text","text":" "},{"type":"text","text":"Because code with "},{"code":"await","type":"codeVoice"},{"text":" needs to be able to suspend execution,","type":"text"},{"type":"text","text":" "},{"text":"only certain places in your program can call asynchronous functions or methods:","type":"text"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Code in the body of an asynchronous function, method, or property."}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Code in the static "},{"type":"codeVoice","code":"main()"},{"text":" method of","type":"text"},{"type":"text","text":" "},{"type":"text","text":"a structure, class, or enumeration that’s marked with "},{"code":"@main","type":"codeVoice"},{"text":".","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Code in an unstructured child task,","type":"text"},{"type":"text","text":" "},{"type":"text","text":"as shown in "},{"identifier":"doc:\/\/org.swift.tspl\/documentation\/The-Swift-Programming-Language\/Concurrency#Concurrencia-desestructurada","type":"reference","isActive":true},{"type":"text","text":" below."}],"type":"paragraph"}]}],"type":"unorderedList"},{"type":"paragraph","inlineContent":[{"text":"Code in between possible suspension points runs sequentially,","type":"text"},{"type":"text","text":" "},{"type":"text","text":"without the possibility of interruption from other concurrent code."},{"type":"text","text":" "},{"type":"text","text":"For example, the code below moves a picture from one gallery to another."}]},{"code":["let firstPhoto = await listPhotos(inGallery: \"Summer Vacation\")[0]","add(firstPhoto, toGallery: \"Road Trip\")","\/\/ At this point, firstPhoto is temporarily in both galleries.","remove(firstPhoto, fromGallery: \"Summer Vacation\")"],"type":"codeListing","syntax":"swift"},{"type":"paragraph","inlineContent":[{"type":"text","text":"There’s no way for other code to run in between"},{"type":"text","text":" "},{"type":"text","text":"the call to "},{"type":"codeVoice","code":"add(_:toGallery:)"},{"text":" and ","type":"text"},{"code":"remove(_:fromGallery:)","type":"codeVoice"},{"type":"text","text":"."},{"type":"text","text":" "},{"text":"During that time, the first photo appears in both galleries,","type":"text"},{"type":"text","text":" "},{"type":"text","text":"temporarily breaking one of the app’s invariants."},{"text":" ","type":"text"},{"type":"text","text":"To make it even clearer that this chunk of code"},{"type":"text","text":" "},{"type":"text","text":"must not have "},{"type":"codeVoice","code":"await"},{"text":" added to it in the future,","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"you can refactor that code into a synchronous function:"}]},{"syntax":"swift","code":["func move(_ photoName: String, from source: String, to destination: String) {","    add(photoName, toGallery: destination)","    remove(photoName, fromGallery: source)","}","\/\/ ...","let firstPhoto = await listPhotos(inGallery: \"Summer Vacation\")[0]","move(firstPhoto, from: \"Summer Vacation\", to: \"Road Trip\")"],"type":"codeListing"},{"inlineContent":[{"text":"In the example above,","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"because the "},{"code":"move(_:from:to:)","type":"codeVoice"},{"type":"text","text":" function is synchronous,"},{"type":"text","text":" "},{"text":"you guarantee that it can never contain possible suspension points.","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"In the future,"},{"type":"text","text":" "},{"type":"text","text":"if you try to add concurrent code to this function,"},{"type":"text","text":" "},{"text":"introducing a possible suspension point,","type":"text"},{"type":"text","text":" "},{"type":"text","text":"you’ll get compile-time error instead of introducing a bug."}],"type":"paragraph"},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"The "},{"type":"reference","isActive":true,"identifier":"https:\/\/developer.apple.com\/documentation\/swift\/task\/sleep(until:tolerance:clock:)"},{"type":"text","text":" method"},{"type":"text","text":" "},{"text":"is useful when writing simple code","type":"text"},{"type":"text","text":" "},{"type":"text","text":"to learn how concurrency works."},{"type":"text","text":" "},{"text":"This method does nothing,","type":"text"},{"text":" ","type":"text"},{"text":"but waits at least the given number of nanoseconds before it returns.","type":"text"},{"type":"text","text":" "},{"type":"text","text":"Here’s a version of the "},{"type":"codeVoice","code":"listPhotos(inGallery:)"},{"type":"text","text":" function"},{"text":" ","type":"text"},{"text":"that uses ","type":"text"},{"type":"codeVoice","code":"sleep(until:tolerance:clock:)"},{"type":"text","text":" to simulate waiting for a network operation:"}]},{"syntax":"swift","type":"codeListing","code":["func listPhotos(inGallery name: String) async throws -> [String] {","    try await Task.sleep(until: .now + .seconds(2), clock: .continuous)","    return [\"IMG001\", \"IMG99\", \"IMG0404\"]","}"]}],"name":"Note","type":"aside","style":"note"},{"text":"Secuencias asíncronas","level":2,"type":"heading","anchor":"Secuencias-as%C3%ADncronas"},{"inlineContent":[{"text":"The ","type":"text"},{"type":"codeVoice","code":"listPhotos(inGallery:)"},{"type":"text","text":" function in the previous section"},{"type":"text","text":" "},{"text":"asynchronously returns the whole array at once,","type":"text"},{"type":"text","text":" "},{"type":"text","text":"after all of the array’s elements are ready."},{"type":"text","text":" "},{"type":"text","text":"Another approach"},{"text":" ","type":"text"},{"text":"is to wait for one element of the collection at a time","type":"text"},{"type":"text","text":" "},{"type":"text","text":"using an "},{"type":"emphasis","inlineContent":[{"text":"asynchronous sequence","type":"text"}]},{"text":".","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"Here’s what iterating over an asynchronous sequence looks like:"}],"type":"paragraph"},{"type":"codeListing","syntax":"swift","code":["import Foundation","","let handle = FileHandle.standardInput","for try await line in handle.bytes.lines {","    print(line)","}"]},{"inlineContent":[{"text":"Instead of using an ordinary ","type":"text"},{"code":"for","type":"codeVoice"},{"text":"-","type":"text"},{"code":"in","type":"codeVoice"},{"text":" loop,","type":"text"},{"type":"text","text":" "},{"text":"the example above writes ","type":"text"},{"code":"for","type":"codeVoice"},{"type":"text","text":" with "},{"code":"await","type":"codeVoice"},{"text":" after it.","type":"text"},{"type":"text","text":" "},{"type":"text","text":"Like when you call an asynchronous function or method,"},{"type":"text","text":" "},{"type":"text","text":"writing "},{"type":"codeVoice","code":"await"},{"type":"text","text":" indicates a possible suspension point."},{"type":"text","text":" "},{"text":"A ","type":"text"},{"type":"codeVoice","code":"for"},{"type":"text","text":"-"},{"type":"codeVoice","code":"await"},{"type":"text","text":"-"},{"type":"codeVoice","code":"in"},{"type":"text","text":" loop potentially suspends execution"},{"text":" ","type":"text"},{"type":"text","text":"at the beginning of each iteration,"},{"text":" ","type":"text"},{"type":"text","text":"when it’s waiting for the next element to be available."}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"text":"In the same way that you can use your own types in a ","type":"text"},{"code":"for","type":"codeVoice"},{"text":"-","type":"text"},{"type":"codeVoice","code":"in"},{"type":"text","text":" loop"},{"type":"text","text":" "},{"text":"by adding conformance to the ","type":"text"},{"identifier":"https:\/\/developer.apple.com\/documentation\/swift\/sequence","type":"reference","isActive":true},{"type":"text","text":" protocol,"},{"type":"text","text":" "},{"text":"you can use your own types in a ","type":"text"},{"code":"for","type":"codeVoice"},{"type":"text","text":"-"},{"code":"await","type":"codeVoice"},{"text":"-","type":"text"},{"type":"codeVoice","code":"in"},{"text":" loop","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"by adding conformance to the"},{"type":"text","text":" "},{"isActive":true,"type":"reference","identifier":"https:\/\/developer.apple.com\/documentation\/swift\/asyncsequence"},{"text":" protocol.","type":"text"}]},{"text":"Invocación de funciones asíncronas en paralelo","type":"heading","level":2,"anchor":"Invocaci%C3%B3n-de-funciones-as%C3%ADncronas-en-paralelo"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Calling an asynchronous function with "},{"type":"codeVoice","code":"await"},{"text":" ","type":"text"},{"type":"text","text":"runs only one piece of code at a time."},{"type":"text","text":" "},{"type":"text","text":"While the asynchronous code is running,"},{"text":" ","type":"text"},{"type":"text","text":"the caller waits for that code to finish"},{"text":" ","type":"text"},{"text":"before moving on to run the next line of code.","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"For example,"},{"text":" ","type":"text"},{"type":"text","text":"to fetch the first three photos from a gallery,"},{"text":" ","type":"text"},{"text":"you could await three calls to the ","type":"text"},{"code":"downloadPhoto(named:)","type":"codeVoice"},{"type":"text","text":" function"},{"text":" ","type":"text"},{"type":"text","text":"as follows:"}]},{"type":"codeListing","syntax":"swift","code":["let firstPhoto = await downloadPhoto(named: photoNames[0])","let secondPhoto = await downloadPhoto(named: photoNames[1])","let thirdPhoto = await downloadPhoto(named: photoNames[2])","","let photos = [firstPhoto, secondPhoto, thirdPhoto]","show(photos)"]},{"inlineContent":[{"text":"This approach has an important drawback:","type":"text"},{"type":"text","text":" "},{"text":"Although the download is asynchronous","type":"text"},{"type":"text","text":" "},{"text":"and lets other work happen while it progresses,","type":"text"},{"type":"text","text":" "},{"text":"only one call to ","type":"text"},{"type":"codeVoice","code":"downloadPhoto(named:)"},{"type":"text","text":" runs at a time."},{"type":"text","text":" "},{"type":"text","text":"Each photo downloads completely before the next one starts downloading."},{"text":" ","type":"text"},{"type":"text","text":"However, there’s no need for these operations to wait —"},{"text":" ","type":"text"},{"text":"each photo can download independently, or even at the same time.","type":"text"}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"type":"text","text":"To call an asynchronous function"},{"text":" ","type":"text"},{"text":"and let it run in parallel with code around it,","type":"text"},{"type":"text","text":" "},{"type":"text","text":"write "},{"code":"async","type":"codeVoice"},{"type":"text","text":" in front of "},{"code":"let","type":"codeVoice"},{"type":"text","text":" when you define a constant,"},{"type":"text","text":" "},{"type":"text","text":"and then write "},{"type":"codeVoice","code":"await"},{"text":" each time you use the constant.","type":"text"}]},{"type":"codeListing","syntax":"swift","code":["async let firstPhoto = downloadPhoto(named: photoNames[0])","async let secondPhoto = downloadPhoto(named: photoNames[1])","async let thirdPhoto = downloadPhoto(named: photoNames[2])","","let photos = await [firstPhoto, secondPhoto, thirdPhoto]","show(photos)"]},{"inlineContent":[{"text":"In this example,","type":"text"},{"type":"text","text":" "},{"type":"text","text":"all three calls to "},{"code":"downloadPhoto(named:)","type":"codeVoice"},{"text":" start","type":"text"},{"text":" ","type":"text"},{"text":"without waiting for the previous one to complete.","type":"text"},{"type":"text","text":" "},{"text":"If there are enough system resources available, they can run at the same time.","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"None of these function calls are marked with "},{"code":"await","type":"codeVoice"},{"text":" ","type":"text"},{"type":"text","text":"because the code doesn’t suspend to wait for the function’s result."},{"text":" ","type":"text"},{"type":"text","text":"Instead, execution continues"},{"type":"text","text":" "},{"type":"text","text":"until the line where "},{"type":"codeVoice","code":"photos"},{"type":"text","text":" is defined —"},{"text":" ","type":"text"},{"type":"text","text":"at that point, the program needs the results from these asynchronous calls,"},{"text":" ","type":"text"},{"type":"text","text":"so you write "},{"code":"await","type":"codeVoice"},{"text":" to pause execution","type":"text"},{"type":"text","text":" "},{"text":"until all three photos finish downloading.","type":"text"}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Here’s how you can think about the differences between these two approaches:"}]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Call asynchronous functions with "},{"type":"codeVoice","code":"await"},{"type":"text","text":" "},{"text":"when the code on the following lines depends on that function’s result.","type":"text"},{"type":"text","text":" "},{"type":"text","text":"This creates work that is carried out sequentially."}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Call asynchronous functions with "},{"code":"async","type":"codeVoice"},{"type":"text","text":"-"},{"code":"let","type":"codeVoice"},{"type":"text","text":" "},{"type":"text","text":"when you don’t need the result until later in your code."},{"type":"text","text":" "},{"type":"text","text":"This creates work that can be carried out in parallel."}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Both "},{"type":"codeVoice","code":"await"},{"text":" and ","type":"text"},{"code":"async","type":"codeVoice"},{"type":"text","text":"-"},{"type":"codeVoice","code":"let"},{"type":"text","text":" "},{"type":"text","text":"allow other code to run while they’re suspended."}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"In both cases, you mark the possible suspension point with ","type":"text"},{"type":"codeVoice","code":"await"},{"text":" ","type":"text"},{"text":"to indicate that execution will pause, if needed,","type":"text"},{"type":"text","text":" "},{"text":"until an asynchronous function has returned.","type":"text"}]}]}]},{"type":"paragraph","inlineContent":[{"text":"You can also mix both of these approaches in the same code.","type":"text"}]},{"anchor":"Tasks-y-Task-Groups","text":"Tasks y Task Groups","level":2,"type":"heading"},{"type":"paragraph","inlineContent":[{"text":"A ","type":"text"},{"type":"emphasis","inlineContent":[{"type":"text","text":"task"}]},{"type":"text","text":" is a unit of work"},{"text":" ","type":"text"},{"type":"text","text":"that can be run asynchronously as part of your program."},{"text":" ","type":"text"},{"type":"text","text":"All asynchronous code runs as part of some task."},{"type":"text","text":" "},{"text":"The ","type":"text"},{"type":"codeVoice","code":"async"},{"text":"-","type":"text"},{"type":"codeVoice","code":"let"},{"text":" syntax described in the previous section","type":"text"},{"text":" ","type":"text"},{"text":"creates a child task for you.","type":"text"},{"type":"text","text":" "},{"text":"You can also create a task group","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"and add child tasks to that group,"},{"text":" ","type":"text"},{"type":"text","text":"which gives you more control over priority and cancellation,"},{"text":" ","type":"text"},{"type":"text","text":"and lets you create a dynamic number of tasks."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Tasks are arranged in a hierarchy."},{"text":" ","type":"text"},{"text":"Each task in a task group has the same parent task,","type":"text"},{"text":" ","type":"text"},{"text":"and each task can have child tasks.","type":"text"},{"type":"text","text":" "},{"text":"Because of the explicit relationship between tasks and task groups,","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"this approach is called "},{"type":"emphasis","inlineContent":[{"type":"text","text":"structured concurrency"}]},{"type":"text","text":"."},{"type":"text","text":" "},{"type":"text","text":"Although you take on some of the responsibility for correctness,"},{"type":"text","text":" "},{"type":"text","text":"the explicit parent-child relationships between tasks"},{"text":" ","type":"text"},{"type":"text","text":"let Swift handle some behaviors like propagating cancellation for you,"},{"text":" ","type":"text"},{"type":"text","text":"and lets Swift detect some errors at compile time."}]},{"code":["await withTaskGroup(of: Data.self) { taskGroup in","    let photoNames = await listPhotos(inGallery: \"Summer Vacation\")","    for name in photoNames {","        taskGroup.addTask { await downloadPhoto(named: name) }","    }","}"],"syntax":"swift","type":"codeListing"},{"inlineContent":[{"type":"text","text":"For more information about task groups,"},{"text":" ","type":"text"},{"type":"text","text":"see "},{"isActive":true,"type":"reference","identifier":"https:\/\/developer.apple.com\/documentation\/swift\/taskgroup"},{"text":".","type":"text"}],"type":"paragraph"},{"anchor":"Concurrencia-desestructurada","text":"Concurrencia desestructurada","level":3,"type":"heading"},{"type":"paragraph","inlineContent":[{"text":"In addition to the structured approaches to concurrency","type":"text"},{"text":" ","type":"text"},{"text":"described in the previous sections,","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"Swift also supports unstructured concurrency."},{"type":"text","text":" "},{"type":"text","text":"Unlike tasks that are part of a task group,"},{"text":" ","type":"text"},{"type":"text","text":"an "},{"type":"emphasis","inlineContent":[{"text":"unstructured task","type":"text"}]},{"type":"text","text":" doesn’t have a parent task."},{"type":"text","text":" "},{"text":"You have complete flexibility to manage unstructured tasks","type":"text"},{"type":"text","text":" "},{"text":"in whatever way your program needs,","type":"text"},{"text":" ","type":"text"},{"text":"but you’re also completely responsible for their correctness.","type":"text"},{"text":" ","type":"text"},{"text":"To create an unstructured task that runs on the current actor,","type":"text"},{"type":"text","text":" "},{"type":"text","text":"call the "},{"isActive":true,"identifier":"https:\/\/developer.apple.com\/documentation\/swift\/task\/3856790-init","type":"reference"},{"text":" initializer.","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"To create an unstructured task that’s not part of the current actor,"},{"text":" ","type":"text"},{"type":"text","text":"known more specifically as a "},{"inlineContent":[{"type":"text","text":"detached task"}],"type":"emphasis"},{"type":"text","text":","},{"type":"text","text":" "},{"type":"text","text":"call the "},{"isActive":true,"identifier":"https:\/\/developer.apple.com\/documentation\/swift\/task\/3856786-detached","type":"reference"},{"text":" class method.","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"Both of these operations return a task that you can interact with —"},{"text":" ","type":"text"},{"text":"for example, to wait for its result or to cancel it.","type":"text"}]},{"syntax":"swift","code":["let newPhoto = \/\/ ... some photo data ...","let handle = Task {","    return await add(newPhoto, toGalleryNamed: \"Spring Adventures\")","}","let result = await handle.value"],"type":"codeListing"},{"type":"paragraph","inlineContent":[{"type":"text","text":"For more information about managing detached tasks,"},{"type":"text","text":" "},{"type":"text","text":"see "},{"type":"reference","isActive":true,"identifier":"https:\/\/developer.apple.com\/documentation\/swift\/task"},{"type":"text","text":"."}]},{"type":"heading","text":"Cancelación de Tasks","level":3,"anchor":"Cancelaci%C3%B3n-de-Tasks"},{"inlineContent":[{"text":"Swift concurrency uses a cooperative cancellation model.","type":"text"},{"type":"text","text":" "},{"type":"text","text":"Each task checks whether it has been canceled"},{"text":" ","type":"text"},{"type":"text","text":"at the appropriate points in its execution,"},{"text":" ","type":"text"},{"type":"text","text":"and responds to cancellation in whatever way is appropriate."},{"type":"text","text":" "},{"text":"Depending on the work you’re doing,","type":"text"},{"type":"text","text":" "},{"text":"that usually means one of the following:","type":"text"}],"type":"paragraph"},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"text":"Throwing an error like ","type":"text"},{"code":"CancellationError","type":"codeVoice"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Returning ","type":"text"},{"code":"nil","type":"codeVoice"},{"text":" or an empty collection","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Returning the partially completed work"}]}]}]},{"type":"paragraph","inlineContent":[{"text":"To check for cancellation,","type":"text"},{"type":"text","text":" "},{"text":"either call ","type":"text"},{"identifier":"https:\/\/developer.apple.com\/documentation\/swift\/task\/3814826-checkcancellation","isActive":true,"type":"reference"},{"type":"text","text":","},{"type":"text","text":" "},{"type":"text","text":"which throws "},{"code":"CancellationError","type":"codeVoice"},{"text":" if the task has been canceled,","type":"text"},{"type":"text","text":" "},{"text":"or check the value of ","type":"text"},{"identifier":"https:\/\/developer.apple.com\/documentation\/swift\/task\/3814832-iscancelled","isActive":true,"type":"reference"},{"type":"text","text":" "},{"type":"text","text":"and handle the cancellation in your own code."},{"type":"text","text":" "},{"type":"text","text":"For example,"},{"text":" ","type":"text"},{"type":"text","text":"a task that’s downloading photos from a gallery"},{"type":"text","text":" "},{"text":"might need to delete partial downloads and close network connections.","type":"text"}]},{"type":"paragraph","inlineContent":[{"text":"To propagate cancellation manually,","type":"text"},{"type":"text","text":" "},{"type":"text","text":"call "},{"type":"reference","identifier":"https:\/\/developer.apple.com\/documentation\/swift\/task\/3851218-cancel","isActive":true},{"type":"text","text":"."}]},{"level":2,"text":"Actores","type":"heading","anchor":"Actores"},{"inlineContent":[{"text":"You can use tasks to break up your program into isolated, concurrent pieces.","type":"text"},{"text":" ","type":"text"},{"text":"Tasks are isolated from each other,","type":"text"},{"text":" ","type":"text"},{"text":"which is what makes it safe for them to run at the same time,","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"but sometimes you need to share some information between tasks."},{"type":"text","text":" "},{"type":"text","text":"Actors let you safely share information between concurrent code."}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"Like classes, actors are reference types,"},{"text":" ","type":"text"},{"type":"text","text":"so the comparison of value types and reference types"},{"type":"text","text":" "},{"text":"in ","type":"text"},{"type":"reference","identifier":"doc:\/\/org.swift.tspl\/documentation\/The-Swift-Programming-Language\/ClassesAndStructures#Las-clases-son-tipos-de-referencia","isActive":true},{"type":"text","text":" "},{"text":"applies to actors as well as classes.","type":"text"},{"type":"text","text":" "},{"type":"text","text":"Unlike classes,"},{"text":" ","type":"text"},{"type":"text","text":"actors allow only one task to access their mutable state at a time,"},{"type":"text","text":" "},{"type":"text","text":"which makes it safe for code in multiple tasks"},{"type":"text","text":" "},{"text":"to interact with the same instance of an actor.","type":"text"},{"type":"text","text":" "},{"type":"text","text":"For example, here’s an actor that records temperatures:"}],"type":"paragraph"},{"syntax":"swift","code":["actor TemperatureLogger {","    let label: String","    var measurements: [Int]","    private(set) var max: Int","","    init(label: String, measurement: Int) {","        self.label = label","        self.measurements = [measurement]","        self.max = measurement","    }","}"],"type":"codeListing"},{"inlineContent":[{"type":"text","text":"You introduce an actor with the "},{"type":"codeVoice","code":"actor"},{"type":"text","text":" keyword,"},{"text":" ","type":"text"},{"type":"text","text":"followed by its definition in a pair of braces."},{"text":" ","type":"text"},{"text":"The ","type":"text"},{"code":"TemperatureLogger","type":"codeVoice"},{"text":" actor has properties","type":"text"},{"type":"text","text":" "},{"type":"text","text":"that other code outside the actor can access,"},{"type":"text","text":" "},{"text":"and restricts the ","type":"text"},{"type":"codeVoice","code":"max"},{"text":" property so only code inside the actor","type":"text"},{"text":" ","type":"text"},{"text":"can update the maximum value.","type":"text"}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"text":"You create an instance of an actor","type":"text"},{"text":" ","type":"text"},{"text":"using the same initializer syntax as structures and classes.","type":"text"},{"type":"text","text":" "},{"text":"When you access a property or method of an actor,","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"you use "},{"code":"await","type":"codeVoice"},{"type":"text","text":" to mark the potential suspension point."},{"type":"text","text":" "},{"type":"text","text":"For example:"}]},{"code":["let logger = TemperatureLogger(label: \"Outdoors\", measurement: 25)","print(await logger.max)","\/\/ Prints \"25\""],"syntax":"swift","type":"codeListing"},{"type":"paragraph","inlineContent":[{"text":"In this example,","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"accessing "},{"code":"logger.max","type":"codeVoice"},{"type":"text","text":" is a possible suspension point."},{"type":"text","text":" "},{"type":"text","text":"Because the actor allows only one task at a time to access its mutable state,"},{"type":"text","text":" "},{"type":"text","text":"if code from another task is already interacting with the logger,"},{"type":"text","text":" "},{"text":"this code suspends while it waits to access the property.","type":"text"}]},{"type":"paragraph","inlineContent":[{"text":"In contrast,","type":"text"},{"type":"text","text":" "},{"type":"text","text":"code that’s part of the actor doesn’t write "},{"type":"codeVoice","code":"await"},{"text":" ","type":"text"},{"text":"when accessing the actor’s properties.","type":"text"},{"text":" ","type":"text"},{"text":"For example,","type":"text"},{"type":"text","text":" "},{"text":"here’s a method that updates a ","type":"text"},{"code":"TemperatureLogger","type":"codeVoice"},{"text":" with a new temperature:","type":"text"}]},{"type":"codeListing","syntax":"swift","code":["extension TemperatureLogger {","    func update(with measurement: Int) {","        measurements.append(measurement)","        if measurement > max {","            max = measurement","        }","    }","}"]},{"type":"paragraph","inlineContent":[{"text":"The ","type":"text"},{"code":"update(with:)","type":"codeVoice"},{"type":"text","text":" method is already running on the actor,"},{"type":"text","text":" "},{"type":"text","text":"so it doesn’t mark its access to properties like "},{"type":"codeVoice","code":"max"},{"type":"text","text":" with "},{"code":"await","type":"codeVoice"},{"type":"text","text":"."},{"type":"text","text":" "},{"text":"This method also shows one of the reasons","type":"text"},{"text":" ","type":"text"},{"text":"why actors allow only one task at a time to interact with their mutable state:","type":"text"},{"type":"text","text":" "},{"text":"Some updates to an actor’s state temporarily break invariants.","type":"text"},{"type":"text","text":" "},{"text":"The ","type":"text"},{"type":"codeVoice","code":"TemperatureLogger"},{"text":" actor keeps track of","type":"text"},{"text":" ","type":"text"},{"text":"a list of temperatures and a maximum temperature,","type":"text"},{"text":" ","type":"text"},{"text":"and it updates the maximum temperature when you record a new measurement.","type":"text"},{"type":"text","text":" "},{"type":"text","text":"In the middle of an update,"},{"text":" ","type":"text"},{"text":"after appending the new measurement but before updating ","type":"text"},{"type":"codeVoice","code":"max"},{"type":"text","text":","},{"text":" ","type":"text"},{"text":"the temperature logger is in a temporary inconsistent state.","type":"text"},{"type":"text","text":" "},{"type":"text","text":"Preventing multiple tasks from interacting with the same instance simultaneously"},{"type":"text","text":" "},{"text":"prevents problems like the following sequence of events:","type":"text"}]},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Your code calls the ","type":"text"},{"type":"codeVoice","code":"update(with:)"},{"type":"text","text":" method."},{"type":"text","text":" "},{"type":"text","text":"It updates the "},{"code":"measurements","type":"codeVoice"},{"text":" array first.","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Before your code can update "},{"code":"max","type":"codeVoice"},{"type":"text","text":","},{"type":"text","text":" "},{"type":"text","text":"code elsewhere reads the maximum value and the array of temperatures."}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Your code finishes its update by changing "},{"code":"max","type":"codeVoice"},{"type":"text","text":"."}]}]}],"type":"orderedList"},{"type":"paragraph","inlineContent":[{"type":"text","text":"In this case,"},{"type":"text","text":" "},{"type":"text","text":"the code running elsewhere would read incorrect information"},{"type":"text","text":" "},{"type":"text","text":"because its access to the actor was interleaved"},{"text":" ","type":"text"},{"text":"in the middle of the call to ","type":"text"},{"type":"codeVoice","code":"update(with:)"},{"type":"text","text":" "},{"text":"while the data was temporarily invalid.","type":"text"},{"type":"text","text":" "},{"type":"text","text":"You can prevent this problem when using Swift actors"},{"text":" ","type":"text"},{"type":"text","text":"because they only allow one operation on their state at a time,"},{"type":"text","text":" "},{"text":"and because that code can be interrupted","type":"text"},{"type":"text","text":" "},{"type":"text","text":"only in places where "},{"type":"codeVoice","code":"await"},{"text":" marks a suspension point.","type":"text"},{"type":"text","text":" "},{"type":"text","text":"Because "},{"type":"codeVoice","code":"update(with:)"},{"text":" doesn’t contain any suspension points,","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"no other code can access the data in the middle of an update."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"If you try to access those properties from outside the actor,"},{"text":" ","type":"text"},{"text":"like you would with an instance of a class,","type":"text"},{"type":"text","text":" "},{"type":"text","text":"you’ll get a compile-time error."},{"text":" ","type":"text"},{"text":"For example:","type":"text"}]},{"syntax":"swift","type":"codeListing","code":["print(logger.max)  \/\/ Error"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Accessing "},{"type":"codeVoice","code":"logger.max"},{"text":" without writing ","type":"text"},{"code":"await","type":"codeVoice"},{"text":" fails because","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"the properties of an actor are part of that actor’s isolated local state."},{"type":"text","text":" "},{"text":"Swift guarantees that","type":"text"},{"type":"text","text":" "},{"type":"text","text":"only code inside an actor can access the actor’s local state."},{"type":"text","text":" "},{"text":"This guarantee is known as ","type":"text"},{"type":"emphasis","inlineContent":[{"type":"text","text":"actor isolation"}]},{"text":".","type":"text"}]},{"text":"Tipos enviables","type":"heading","anchor":"Tipos-enviables","level":2},{"type":"paragraph","inlineContent":[{"text":"Tasks and actors let you divide a program","type":"text"},{"text":" ","type":"text"},{"text":"into pieces that can safely run concurrently.","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"Inside of a task or an instance of an actor,"},{"text":" ","type":"text"},{"type":"text","text":"the part of a program that contains mutable state,"},{"type":"text","text":" "},{"type":"text","text":"like variables and properties,"},{"type":"text","text":" "},{"type":"text","text":"is called a "},{"type":"emphasis","inlineContent":[{"text":"concurrency domain","type":"text"}]},{"text":".","type":"text"},{"type":"text","text":" "},{"type":"text","text":"Some kinds of data can’t be shared between concurrency domains,"},{"type":"text","text":" "},{"text":"because that data contains mutable state,","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"but it doesn’t protect against overlapping access."}]},{"inlineContent":[{"text":"A type that can be shared from one concurrency domain to another","type":"text"},{"text":" ","type":"text"},{"text":"is known as a ","type":"text"},{"inlineContent":[{"type":"text","text":"sendable"}],"type":"emphasis"},{"type":"text","text":" type."},{"type":"text","text":" "},{"text":"For example, it can be passed as an argument when calling an actor method","type":"text"},{"type":"text","text":" "},{"type":"text","text":"or be returned as the result of a task."},{"text":" ","type":"text"},{"type":"text","text":"The examples earlier in this chapter didn’t discuss sendability"},{"type":"text","text":" "},{"text":"because those examples use simple value types","type":"text"},{"type":"text","text":" "},{"type":"text","text":"that are always safe to share"},{"text":" ","type":"text"},{"type":"text","text":"for the data being passed between concurrency domains."},{"type":"text","text":" "},{"type":"text","text":"In contrast,"},{"type":"text","text":" "},{"type":"text","text":"some types aren’t safe to pass across concurrency domains."},{"type":"text","text":" "},{"type":"text","text":"For example, a class that contains mutable properties"},{"type":"text","text":" "},{"type":"text","text":"and doesn’t serialize access to those properties"},{"type":"text","text":" "},{"type":"text","text":"can produce unpredictable and incorrect results"},{"text":" ","type":"text"},{"type":"text","text":"when you pass instances of that class between different tasks."}],"type":"paragraph"},{"inlineContent":[{"text":"You mark a type as being sendable","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"by declaring conformance to the "},{"code":"Sendable","type":"codeVoice"},{"type":"text","text":" protocol."},{"type":"text","text":" "},{"type":"text","text":"That protocol doesn’t have any code requirements,"},{"text":" ","type":"text"},{"type":"text","text":"but it does have semantic requirements that Swift enforces."},{"text":" ","type":"text"},{"text":"In general, there are three ways for a type to be sendable:","type":"text"}],"type":"paragraph"},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"The type is a value type,"},{"text":" ","type":"text"},{"text":"and its mutable state is made up of other sendable data —","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"for example, a structure with stored properties that are sendable"},{"text":" ","type":"text"},{"type":"text","text":"or an enumeration with associated values that are sendable."}]}]},{"content":[{"inlineContent":[{"text":"The type doesn’t have any mutable state,","type":"text"},{"type":"text","text":" "},{"type":"text","text":"and its immutable state is made up of other sendable data —"},{"text":" ","type":"text"},{"text":"for example, a structure or class that has only read-only properties.","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"The type has code that ensures the safety of its mutable state,"},{"type":"text","text":" "},{"text":"like a class that’s marked ","type":"text"},{"type":"codeVoice","code":"@MainActor"},{"text":" ","type":"text"},{"type":"text","text":"or a class that serializes access to its properties"},{"text":" ","type":"text"},{"type":"text","text":"on a particular thread or queue."}],"type":"paragraph"}]}]},{"inlineContent":[{"text":"For a detailed list of the semantic requirements,","type":"text"},{"text":" ","type":"text"},{"text":"see the ","type":"text"},{"isActive":true,"identifier":"https:\/\/developer.apple.com\/documentation\/swift\/sendable","type":"reference"},{"text":" protocol reference.","type":"text"}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Some types are always sendable,"},{"text":" ","type":"text"},{"type":"text","text":"like structures that have only sendable properties"},{"type":"text","text":" "},{"type":"text","text":"and enumerations that have only sendable associated values."},{"type":"text","text":" "},{"type":"text","text":"For example:"}]},{"type":"codeListing","syntax":"swift","code":["struct TemperatureReading: Sendable {","    var measurement: Int","}","","extension TemperatureLogger {","    func addReading(from reading: TemperatureReading) {","        measurements.append(reading.measurement)","    }","}","","let logger = TemperatureLogger(label: \"Tea kettle\", measurement: 85)","let reading = TemperatureReading(measurement: 45)","await logger.addReading(from: reading)"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Because "},{"code":"TemperatureReading","type":"codeVoice"},{"text":" is a structure that has only sendable properties,","type":"text"},{"type":"text","text":" "},{"type":"text","text":"and the structure isn’t marked "},{"code":"public","type":"codeVoice"},{"text":" or ","type":"text"},{"code":"@usableFromInline","type":"codeVoice"},{"text":",","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"it’s implicitly sendable."},{"type":"text","text":" "},{"type":"text","text":"Here’s a version of the structure"},{"type":"text","text":" "},{"type":"text","text":"where conformance to the "},{"code":"Sendable","type":"codeVoice"},{"text":" protocol is implied:","type":"text"}]},{"syntax":"swift","code":["struct TemperatureReading {","    var measurement: Int","}"],"type":"codeListing"},{"inlineContent":[{"type":"text","text":"To explicitly mark a type as not being sendable,"},{"type":"text","text":" "},{"type":"text","text":"overriding an implicit conformance to the "},{"code":"Sendable","type":"codeVoice"},{"text":" protocol,","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"use an extension:"}],"type":"paragraph"},{"type":"codeListing","syntax":"swift","code":["struct FileDescriptor {","    let rawValue: CInt","}","","@available(*, unavailable)","extension FileDescriptor: Sendable { }"]},{"inlineContent":[{"type":"text","text":"The code above shows part of a wrapper around POSIX file descriptors."},{"type":"text","text":" "},{"text":"Even though interface for file descriptors uses integers","type":"text"},{"type":"text","text":" "},{"type":"text","text":"to identify and interact with open files,"},{"text":" ","type":"text"},{"type":"text","text":"and integer values are sendable,"},{"type":"text","text":" "},{"type":"text","text":"a file descriptor isn’t safe to send across concurrency domains."}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"type":"text","text":"In the code above,"},{"type":"text","text":" "},{"type":"text","text":"the "},{"type":"codeVoice","code":"NonsendableTemperatureReading"},{"type":"text","text":" is a structure"},{"type":"text","text":" "},{"type":"text","text":"that meets the criteria to be implicitly sendable."},{"text":" ","type":"text"},{"text":"However, the extension makes its conformance to ","type":"text"},{"type":"codeVoice","code":"Sendable"},{"text":" unavailable,","type":"text"},{"text":" ","type":"text"},{"text":"preventing the type from being sendable.","type":"text"}]},{"type":"aside","content":[{"inlineContent":[{"type":"text","text":""}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"Esta documentación contiene información preliminar sobre una API o tecnología en desarrollo. Esta información está sujeta a cambios, y todo software implementado en conformidad con esta documentación debe ser testeado con el software final del sistema operativo."}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"Conoce más acerca del uso del "},{"identifier":"https:\/\/developer.apple.com\/es\/support\/beta-software\/","isActive":true,"type":"reference"},{"text":".","type":"text"}],"type":"paragraph"}],"style":"note","name":"Software Beta"}],"kind":"content"}],"hierarchy":{"paths":[["doc:\/\/org.swift.tspl\/documentation\/The-Swift-Programming-Language"]]},"metadata":{"title":"Concurrencia"},"abstract":[{"type":"text","text":"Perform asynchronous operations."}],"references":{"https://developer.apple.com/documentation/swift/task/3856790-init":{"titleInlineContent":[{"code":"Task.init(priority:operation:)","type":"codeVoice"}],"identifier":"https:\/\/developer.apple.com\/documentation\/swift\/task\/3856790-init","type":"link","title":"Task.init(priority:operation:)","url":"https:\/\/developer.apple.com\/documentation\/swift\/task\/3856790-init"},"https://developer.apple.com/documentation/swift/task/3814832-iscancelled":{"titleInlineContent":[{"code":"Task.isCancelled","type":"codeVoice"}],"identifier":"https:\/\/developer.apple.com\/documentation\/swift\/task\/3814832-iscancelled","type":"link","title":"Task.isCancelled","url":"https:\/\/developer.apple.com\/documentation\/swift\/task\/3814832-iscancelled"},"https://developer.apple.com/documentation/swift/task/3851218-cancel":{"titleInlineContent":[{"code":"Task.cancel()","type":"codeVoice"}],"identifier":"https:\/\/developer.apple.com\/documentation\/swift\/task\/3851218-cancel","type":"link","title":"Task.cancel()","url":"https:\/\/developer.apple.com\/documentation\/swift\/task\/3851218-cancel"},"https://developer.apple.com/documentation/swift/task/sleep(until:tolerance:clock:)":{"titleInlineContent":[{"code":"Task.sleep(until:tolerance:clock:)","type":"codeVoice"}],"identifier":"https:\/\/developer.apple.com\/documentation\/swift\/task\/sleep(until:tolerance:clock:)","type":"link","title":"Task.sleep(until:tolerance:clock:)","url":"https:\/\/developer.apple.com\/documentation\/swift\/task\/sleep(until:tolerance:clock:)"},"doc://org.swift.tspl/documentation/The-Swift-Programming-Language":{"kind":"article","role":"collection","url":"\/documentation\/the-swift-programming-language","abstract":[],"title":"The Swift Programming Language (6)","type":"topic","identifier":"doc:\/\/org.swift.tspl\/documentation\/The-Swift-Programming-Language"},"https://developer.apple.com/es/support/beta-software/":{"titleInlineContent":[{"text":"software beta de Apple","type":"text"}],"identifier":"https:\/\/developer.apple.com\/es\/support\/beta-software\/","type":"link","title":"software beta de Apple","url":"https:\/\/developer.apple.com\/es\/support\/beta-software\/"},"https://developer.apple.com/documentation/swift/task/3856786-detached":{"titleInlineContent":[{"code":"Task.detached(priority:operation:)","type":"codeVoice"}],"identifier":"https:\/\/developer.apple.com\/documentation\/swift\/task\/3856786-detached","type":"link","title":"Task.detached(priority:operation:)","url":"https:\/\/developer.apple.com\/documentation\/swift\/task\/3856786-detached"},"https://developer.apple.com/documentation/swift/taskgroup":{"titleInlineContent":[{"code":"TaskGroup","type":"codeVoice"}],"identifier":"https:\/\/developer.apple.com\/documentation\/swift\/taskgroup","type":"link","title":"TaskGroup","url":"https:\/\/developer.apple.com\/documentation\/swift\/taskgroup"},"doc://org.swift.tspl/documentation/The-Swift-Programming-Language/ClassesAndStructures#Las-clases-son-tipos-de-referencia":{"abstract":[],"kind":"section","identifier":"doc:\/\/org.swift.tspl\/documentation\/The-Swift-Programming-Language\/ClassesAndStructures#Las-clases-son-tipos-de-referencia","type":"topic","title":"Las clases son tipos de referencia","url":"\/documentation\/the-swift-programming-language\/classesandstructures#Las-clases-son-tipos-de-referencia"},"https://developer.apple.com/documentation/swift/task/3814826-checkcancellation":{"titleInlineContent":[{"code":"Task.checkCancellation()","type":"codeVoice"}],"identifier":"https:\/\/developer.apple.com\/documentation\/swift\/task\/3814826-checkcancellation","type":"link","title":"Task.checkCancellation()","url":"https:\/\/developer.apple.com\/documentation\/swift\/task\/3814826-checkcancellation"},"https://developer.apple.com/documentation/swift/asyncsequence":{"titleInlineContent":[{"code":"AsyncSequence","type":"codeVoice"}],"identifier":"https:\/\/developer.apple.com\/documentation\/swift\/asyncsequence","type":"link","title":"AsyncSequence","url":"https:\/\/developer.apple.com\/documentation\/swift\/asyncsequence"},"https://developer.apple.com/documentation/swift/sequence":{"titleInlineContent":[{"code":"Sequence","type":"codeVoice"}],"identifier":"https:\/\/developer.apple.com\/documentation\/swift\/sequence","type":"link","title":"Sequence","url":"https:\/\/developer.apple.com\/documentation\/swift\/sequence"},"https://developer.apple.com/documentation/swift/task":{"titleInlineContent":[{"code":"Task","type":"codeVoice"}],"identifier":"https:\/\/developer.apple.com\/documentation\/swift\/task","type":"link","title":"Task","url":"https:\/\/developer.apple.com\/documentation\/swift\/task"},"doc://org.swift.tspl/documentation/The-Swift-Programming-Language/Concurrency#Concurrencia-desestructurada":{"abstract":[],"kind":"section","identifier":"doc:\/\/org.swift.tspl\/documentation\/The-Swift-Programming-Language\/Concurrency#Concurrencia-desestructurada","type":"topic","title":"Concurrencia desestructurada","url":"\/documentation\/the-swift-programming-language\/concurrency#Concurrencia-desestructurada"},"https://developer.apple.com/documentation/swift/sendable":{"titleInlineContent":[{"code":"Sendable","type":"codeVoice"}],"identifier":"https:\/\/developer.apple.com\/documentation\/swift\/sendable","type":"link","title":"Sendable","url":"https:\/\/developer.apple.com\/documentation\/swift\/sendable"}}}